<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<meta name="theme-color" content="#4f46e5">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<title>La Dolorosa</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800;900&display=swap" rel="stylesheet">
<style>
/* ESTILOS ORIGINALES */
:root {
  --primary: #4f46e5; --primary-light: #e0e7ff; --primary-dark: #3730a3;
  --bg: #f8fafc; --card: #ffffff;
  --text: #0f172a; --muted: #64748b; --border: #e2e8f0;
  --success: #10b981; --success-bg: #d1fae5;
  --danger: #ef4444; --danger-bg: #fee2e2;
  --warning: #f59e0b; --warning-bg: #fef3c7;
  --radius: 16px;
  --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03);
}
* { box-sizing: border-box; -webkit-tap-highlight-color: transparent; -webkit-touch-callout: none; user-select: none; -webkit-user-select: none; }
input, textarea, .receipt-paper { user-select: text !important; -webkit-user-select: text !important; }
body { margin: 0; background: var(--bg); color: var(--text); font-family: 'Inter', sans-serif; font-size: 14px; overscroll-behavior-y: none; }

/* LANDING PAGE */
#landing-page { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg); z-index: 5000; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px; transition: opacity 0.3s ease; }
.landing-content { width: 100%; max-width: 400px; text-align: center; }
.landing-logo { font-size: 60px; margin-bottom: 10px; display: block; filter: drop-shadow(0 4px 6px rgba(0,0,0,0.1)); }
.landing-title { font-size: 28px; font-weight: 900; color: var(--text); margin: 0 0 30px 0; letter-spacing: -1px; }
.venue-btn { width: 100%; background: white; border: 1px solid var(--border); padding: 20px; margin-bottom: 15px; border-radius: 20px; font-size: 18px; font-weight: 800; color: var(--primary); box-shadow: 0 4px 15px rgba(0,0,0,0.05); cursor: pointer; transition: all 0.2s ease; display: flex; align-items: center; justify-content: space-between; }
.venue-btn:active { transform: scale(0.98); background: var(--primary-light); }
.venue-btn span:last-child { font-size: 26px; }

/* APP PRINCIPAL */
#app-container { display: none; padding-bottom: 140px; }
header { background: var(--card); padding: 12px 20px; position: sticky; top: 0; z-index: 1000; box-shadow: 0 2px 10px rgba(0,0,0,0.05); display: flex; justify-content: space-between; align-items: center; padding-top: env(safe-area-inset-top); height: 70px; }
.logo-container { display: flex; align-items: center; gap: 8px; cursor: pointer; transition: opacity 0.2s; }
.logo-container:active { opacity: 0.6; }
.back-arrow { color: var(--primary); margin-right: 4px; }
.logo-icon { font-size: 26px; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1)); }
header h1 { margin: 0; font-size: 1.5rem; font-weight: 800; color: var(--primary); letter-spacing: -0.5px; }
.header-actions { display: flex; align-items: center; gap: 12px; }
.btn-edit-toggle { background: none; border: none; cursor: pointer; padding: 8px; color: var(--muted); transition: all 0.2s ease; display: flex; align-items: center; justify-content: center; border-radius: 50%; }
.btn-edit-toggle:active { background-color: var(--bg); transform: scale(0.95); }
.btn-edit-toggle.active { color: var(--primary); background-color: var(--primary-light); box-shadow: 0 0 0 1px var(--primary-light); }
.total-badge { text-align: right; }
.total-badge small { display: block; font-size: 10px; color: var(--muted); font-weight: 600; text-transform: uppercase; }
.total-badge div { font-size: 1.4rem; font-weight: 800; color: var(--text); line-height: 1.1; }
.container { padding: 15px; margin: 0 auto; max-width: 800px; }

/* NAVEGACI√ìN Y COMPONENTES */
.nav-scroll { display: flex; overflow-x: auto; gap: 10px; padding: 10px 20px; position: sticky; top: 70px; z-index: 900; background: var(--bg); margin: -15px -15px 15px -15px; -webkit-overflow-scrolling: touch; cursor: grab; border-bottom: 1px solid rgba(0,0,0,0.05); scrollbar-width: none; }
.nav-scroll::-webkit-scrollbar { display: none; }
.tab-btn { display: inline-flex; align-items: center; justify-content: center; gap: 6px; white-space: nowrap; padding: 10px 18px; border-radius: 20px; border: 1px solid transparent; background: var(--card); color: var(--muted); font-weight: 600; font-size: 13px; box-shadow: 0 1px 3px rgba(0,0,0,0.05); cursor: pointer; transition: all 0.2s; flex-shrink: 0; }
.tab-btn.active { background: var(--text); color: white; box-shadow: 0 4px 10px rgba(0,0,0,0.2); transform: translateY(-1px); }
.tab-btn-add { background: var(--primary-light); color: var(--primary); border: 1px solid var(--primary-light); }
.tab-btn-editor { background: #fee2e2; color: #b91c1c; border: 1px solid #fca5a5; display: none; }
.tab-btn-editor.visible { display: inline-flex; }
.card { background: var(--card); border-radius: var(--radius); box-shadow: var(--shadow); overflow: hidden; margin-bottom: 16px; border: 1px solid var(--border); }
.card-header { padding: 15px; background: #fff; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
.card-title { font-weight: 700; font-size: 15px; color: var(--text); }
.hidden { display: none !important; }
.item-row { display: flex; justify-content: space-between; align-items: center; padding: 12px 15px; border-bottom: 1px dashed var(--border); }
.item-row:last-child { border-bottom: none; }
.item-info b { display: block; font-size: 14px; }
.item-info small { color: var(--muted); }

/* EDITOR Y FORMULARIOS */
.editor-section-title { font-size: 12px; font-weight: 800; color: var(--muted); text-transform: uppercase; margin: 20px 0 10px 5px; letter-spacing: 0.5px; }
.editor-card-item { padding: 12px; border-bottom: 1px solid var(--border); display: grid; grid-template-columns: 1fr auto; gap: 10px; align-items: center; background: #fff; }
.editor-card-item:last-child { border-bottom: none; }
.editor-inputs-group { display: flex; flex-direction: column; gap: 6px; width: 100%; }
.editor-input-row { display: flex; gap: 8px; }
.editor-input { padding: 8px 10px; border: 1px solid var(--border); border-radius: 8px; font-family: 'Inter', sans-serif; font-size: 13px; width: 100%; background: #f8fafc; transition: all 0.2s; }
.editor-input:focus { outline: none; border-color: var(--primary); background: #fff; }
.editor-actions { display: flex; flex-direction: column; gap: 5px; align-items: flex-end; }
.btn-delete-item { color: var(--danger); background: var(--danger-bg); border: none; border-radius: 8px; width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; cursor: pointer; }
.btn-delete-item:active { transform: scale(0.95); }
.new-item-container { background: white; padding: 20px; border-radius: 16px; box-shadow: var(--shadow); border: 1px solid var(--border); margin-bottom: 40px; }
.new-item-title { font-weight: 800; font-size: 16px; margin-bottom: 15px; display: flex; align-items: center; gap: 8px; color: var(--primary); }
.form-grid { display: grid; gap: 12px; }

/* UTILIDADES */
.select-fancy { appearance: none; -webkit-appearance: none; background-color: #fff; border: 1px solid var(--border); border-radius: 12px; padding: 12px 40px 12px 16px; font-size: 14px; font-weight: 700; color: var(--text); cursor: pointer; width: 100%; box-shadow: 0 2px 5px rgba(0,0,0,0.03); background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%2364748b' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e"); background-repeat: no-repeat; background-position: right 14px center; background-size: 16px; transition: all 0.2s ease; }
.select-fancy:focus { outline: none; border-color: var(--primary); background-color: #fff; box-shadow: 0 0 0 3px var(--primary-light); }
.select-compact { padding: 8px 30px 8px 12px; font-size: 13px; background-position: right 10px center; background-size: 14px; }
.pax-header-input { font-size: 18px; font-weight: 800; color: var(--primary); border: 1px solid transparent; background: transparent; width: 100%; outline: none; padding: 5px; border-radius: 6px; transition: all 0.2s ease; font-family: 'Inter', sans-serif; }
.pax-header-input:focus { background: var(--bg); border-color: var(--primary-light); color: var(--text); }
.stepper { display: flex; align-items: center; background: var(--bg); border-radius: 10px; padding: 2px; }
.stepper btn { width: 40px; height: 36px; border: none; background: white; border-radius: 8px; font-weight: 800; font-size: 18px; color: var(--primary); cursor: pointer; box-shadow: 0 1px 2px rgba(0,0,0,0.1); display: flex; align-items: center; justify-content: center; }
.stepper btn:active { transform: scale(0.95); background: #e0e7ff; }
.stepper span { min-width: 30px; text-align: center; font-weight: 700; font-size: 14px; }
details { border-bottom: 1px solid var(--border); transition: all 0.3s ease; }
details:last-of-type { border-bottom: none; }
summary { padding: 15px; font-weight: 600; cursor: pointer; list-style: none; display: flex; justify-content: space-between; align-items: center; background: #fff; }
summary:hover { background: #f8fafc; }
summary::-webkit-details-marker { display: none; }
summary::after { content: '+'; font-size: 18px; font-weight: 400; color: var(--muted); }
details[open] summary::after { content: '-'; color: var(--primary); }
details[open] summary { background: #fafafa; border-bottom: 1px solid var(--border); color: var(--primary); }

/* RESUMEN Y TICKET */
.balance-container details { border: none; margin-bottom: 10px; background:transparent; }
.balance-container summary { background: var(--card); border: 1px solid var(--border); border-radius: 12px; margin-bottom: 0; color: var(--text) !important; }
.balance-container details[open] summary { border-bottom-left-radius: 0; border-bottom-right-radius: 0; border-bottom: 1px solid var(--border); background: #fff; }
.balance-detail-list { background: #fff; border: 1px solid var(--border); border-top: none; border-bottom-left-radius: 12px; border-bottom-right-radius: 12px; padding: 10px 15px; font-size: 12px; color: var(--muted); }
.balance-detail-item { display: flex; justify-content: space-between; padding: 4px 0; border-bottom: 1px solid #f1f5f9; }
.balance-detail-item:last-child { border-bottom: none; }
.is-payer { background: var(--success-bg); border-color: #bbf7d0; }
.is-debtor { background: var(--danger-bg); border-color: #fecaca; }
.receipt-paper { background: #fff; width: 100%; max-width: 360px; margin: 10px auto; padding: 20px; font-family: 'Courier New', Courier, monospace; color: #222; position: relative; filter: drop-shadow(0 5px 10px rgba(0,0,0,0.1)); }
.receipt-paper::after { content: ""; position: absolute; left: 0; bottom: -10px; width: 100%; height: 10px; background-image: linear-gradient(135deg, transparent 50%, #fff 50%), linear-gradient(45deg, #fff 50%, transparent 50%); background-position: top left, top right; background-size: 10px 10px; background-repeat: repeat-x; }
.receipt-header { text-align: center; margin-bottom: 20px; }
.receipt-header h2 { font-size: 28px; margin: 0; font-weight: 800; text-transform: uppercase; letter-spacing: 1px; color: #000; }
.receipt-header p { font-size: 12px; margin: 2px 0; color: #555; }
.receipt-divider { border-top: 1px dashed #222; margin: 10px 0; }
.receipt-row { display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 8px; font-size: 13px; line-height: 1.4; }
.receipt-row span:first-child { text-align: left; padding-right: 10px; }
.receipt-row span:last-child { text-align: right; white-space: nowrap; font-weight: 700; }
.receipt-total { margin-top: 15px; border-top: 2px solid #222; border-bottom: 2px solid #222; padding: 10px 0; display: flex; justify-content: space-between; font-size: 18px; font-weight: 900; }
.receipt-footer { text-align: center; margin-top: 20px; font-size: 11px; color: #555; }
.barcode { height: 30px; background: repeating-linear-gradient(90deg, #222, #222 2px, transparent 2px, transparent 4px, #222 4px, #222 8px); margin: 15px auto; width: 80%; opacity: 0.8; }
.fab-container { position: fixed; bottom: 25px; right: 25px; z-index: 2000; display: flex; flex-direction: column; align-items: flex-end; gap: 12px; }
.fab-btn { padding: 12px 20px; border-radius: 50px; font-weight: 700; display: flex; align-items: center; gap: 8px; border: none; cursor: pointer; box-shadow: 0 4px 15px rgba(0,0,0,0.2); transition: transform 0.1s, background 0.2s; font-size: 14px; }
.fab-btn:active { transform: scale(0.95); }
.fab-share { background: var(--primary); color: white; box-shadow: 0 4px 15px rgba(79, 70, 229, 0.4); }
.fab-copy { background: var(--text); color: white; box-shadow: 0 4px 15px rgba(15, 23, 42, 0.4); }
.btn-action { width: 100%; padding: 18px; margin-top: 12px; border-radius: 12px; font-weight: 700; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px; font-size: 14px; transition: all 0.2s ease; border: none; position: relative; overflow: hidden; }
.btn-action:active { transform: scale(0.98); }
.btn-reset { background: #f1f5f9; color: #475569; box-shadow: 0 2px 0 #cbd5e1; }
.btn-reset:active { box-shadow: none; transform: translateY(2px); }
.btn-factory { background: #fee2e2; color: #991b1b; box-shadow: 0 2px 0 #fecaca; margin-bottom: 60px; }
.btn-factory:active { box-shadow: none; transform: translateY(2px); }
.btn-delete-pax { background: var(--danger-bg); border: none; color: var(--danger); width: 40px; height: 40px; border-radius: 8px; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: background 0.2s; flex-shrink: 0; }
.btn-delete-pax:hover { background: #fecaca; }
.split-row { margin-top: 8px; background: #fff; padding: 8px 12px; border-radius: 10px; border: 1px solid var(--border); display: flex; gap: 8px; align-items: center; box-shadow: 0 1px 2px rgba(0,0,0,0.02); }
.general-banner { background: var(--warning-bg); color: #92400e; padding: 15px; border-radius: 12px; margin-bottom: 15px; font-size: 13px; border: 1px solid #fcd34d; display: flex; align-items: center; gap: 10px; }
</style>
</head>
<body>

<div id="landing-page">
  <div class="landing-content">
    <span class="landing-logo">üí∏</span>
    <h1 class="landing-title">¬øD√≥nde estamos?</h1>
    <button class="venue-btn" onclick="startApp('aiur')">
      <span>Club Ciclista Irun√©s</span>
      <span>üö¥</span>
    </button>
    <button class="venue-btn" onclick="startApp('ekhi')">
      <span>La Salle</span>
      <span>üéì</span>
    </button>
    <button class="venue-btn" onclick="startApp('galarza')">
      <span>Atsegi√±a</span>
      <span>üë®‚Äçüç≥</span>
    </button>
  </div>
</div>

<div id="app-container">
  <header>
    <div class="logo-container" onclick="goBack()">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="back-arrow"><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></svg>
      <span class="logo-icon">üí∏</span>
      <h1 style="font-size:1.2rem; line-height:1;">La <span style="color:var(--text)">Dolorosa</span></h1>
    </div>
    <div class="header-actions">
        <button id="btnEditMode" class="btn-edit-toggle" onclick="toggleAdminMode()">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"></path></svg>
        </button>
        <div class="total-badge">
          <small>A PAGAR</small>
          <div id="headerTotal">0.00‚Ç¨</div>
        </div>
    </div>
  </header>
  <div class="container">
    <div class="nav-scroll" id="navContainer"></div>
    <div id="views"></div>
  </div>
  <div class="fab-container hidden" id="actionButtons">
    <button class="fab-btn fab-copy" id="btnCopy" onclick="copyBill()"><span>üìã Copiar</span></button>
    <button class="fab-btn fab-share" onclick="shareNative()">
      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="18" cy="5" r="3"></circle><circle cx="6" cy="12" r="3"></circle><circle cx="18" cy="19" r="3"></circle><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line></svg>
      <span>Compartir</span>
    </button>
  </div>
</div>

<script type="module">
// --- FIREBASE SETUP ---
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getDatabase, ref, set, onValue, off, remove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyAcmywgX6l4x_dTnmA1c_CbtAh7LfSx4vg",
  authDomain: "la-dolorosa-68870.firebaseapp.com",
  databaseURL: "https://la-dolorosa-68870-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "la-dolorosa-68870",
  storageBucket: "la-dolorosa-68870.firebasestorage.app",
  messagingSenderId: "387013198617",
  appId: "1:387013198617:web:91910b92149292fe913b88"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const ADMIN_CODE = "1234";

// ============================================
// DATOS DEL MEN√ö - AQU√ç EST√ÅN TUS CAMBIOS
// ============================================

// --- LISTA GENERAL (ANTIGUA) ---
const MENU_GENERAL = [
  { cat: "üç∑ Ardoak / Vinos", n: "Ardo beltza ¬∑ Tinto", p: 3.50, v: 'all' },
  { cat: "üç∑ Ardoak / Vinos", n: "Ardo gorria ¬∑ Rosado", p: 3.50, v: 'all' },
  { cat: "üç∑ Ardoak / Vinos", n: "Rueda Bitacora", p: 4.50, v: 'all' },
  { cat: "üç∑ Ardoak / Vinos", n: "Crianza Glorioso", p: 7.50, v: 'all' },
  { cat: "üç∑ Ardoak / Vinos", n: "Cuarto crianza", p: 5.50, v: 'all' },
  { cat: "üç∑ Ardoak / Vinos", n: "Txakoli", p: 7.50, v: 'all' },
  { cat: "üç∑ Ardoak / Vinos", n: "Moscato", p: 5.00, v: 'all' },
  { cat: "üç∑ Ardoak / Vinos", n: "Sagardoa ¬∑ Sidra", p: 3.00, v: 'all' },
  { cat: "üç∑ Ardoak / Vinos", n: "Cava", p: 10.00, v: 'all' },
  { cat: "üç∑ Ardoak / Vinos", n: "Descorche / Kanpoko", p: 2.50, v: 'all' },
  { cat: "üç∫ Garagardoak / Cervezas", n: "San Miguel/Estrella", p: 1.30, v: 'all' },
  { cat: "üç∫ Garagardoak / Cervezas", n: "Daura", p: 1.80, v: 'all' },
  { cat: "üç∫ Garagardoak / Cervezas", n: "Voll-Damm", p: 1.50, v: 'all' },
  { cat: "üç∫ Garagardoak / Cervezas", n: "0,0", p: 1.30, v: 'all' },
  { cat: "üç∫ Garagardoak / Cervezas", n: "Radler", p: 1.20, v: 'all' },
  { cat: "üç∫ Garagardoak / Cervezas", n: "Alhambra", p: 2.00, v: 'all' },
  { cat: "ü•§ Freskagarriak / Refrescos", n: "Coca-Cola", p: 1.20, v: 'all' },
  { cat: "ü•§ Freskagarriak / Refrescos", n: "Kas Laranja/Limoia", p: 1.00, v: 'all' },
  { cat: "ü•§ Freskagarriak / Refrescos", n: "T√≥nica Schweppes", p: 1.50, v: 'all' },
  { cat: "ü•§ Freskagarriak / Refrescos", n: "Aquarius", p: 1.50, v: 'all' },
  { cat: "ü•§ Freskagarriak / Refrescos", n: "Ura ¬∑ Agua", p: 0.60, v: 'all' },
  { cat: "‚òï Kafeak / Caf√©s", n: "Kafea ¬∑ Caf√©", p: 1.20, v: 'all' },
  { cat: "‚òï Kafeak / Caf√©s", n: "Kafeinagabeko", p: 1.20, v: 'all' },
  { cat: "‚òï Kafeak / Caf√©s", n: "Cola Cao", p: 1.00, v: 'all' },
  { cat: "‚òï Kafeak / Caf√©s", n: "Esne ¬∑ Leche", p: 1.00, v: 'all' },
  { cat: "‚òï Kafeak / Caf√©s", n: "Infusioak", p: 1.00, v: 'all' },
  { cat: "üç∏ Likoreak / Licores", n: "Patxarana", p: 2.50, v: 'all' },
  { cat: "üç∏ Likoreak / Licores", n: "Uxual Krema", p: 2.20, v: 'all' },
  { cat: "üç∏ Likoreak / Licores", n: "Ginebra Beefeater", p: 2.20, v: 'all' },
  { cat: "üç∏ Likoreak / Licores", n: "Ron Habana/Barcel√≥", p: 2.20, v: 'all' },
  { cat: "üç∏ Likoreak / Licores", n: "Vodka Smirnoff/Absolut", p: 2.50, v: 'all' },
  { cat: "üç∏ Likoreak / Licores", n: "Cointreau", p: 2.70, v: 'all' },
  { cat: "üç∏ Likoreak / Licores", n: "Torres 10", p: 2.20, v: 'all' },
  { cat: "üç∏ Likoreak / Licores", n: "Armagnac", p: 3.70, v: 'all' },
  { cat: "üç∏ Likoreak / Licores", n: "Whisky J.B.", p: 2.60, v: 'all' },
  { cat: "üç∏ Likoreak / Licores", n: "Belar/Hierbas", p: 2.20, v: 'all' },
  { cat: "üç∏ Likoreak / Licores", n: "J√§germeister", p: 2.50, v: 'all' },
  { cat: "üç≥ Sukaldea / Cocina", n: "Olioa ¬∑ Aceite", p: 2.00, v: 'all' },
  { cat: "üç≥ Sukaldea / Cocina", n: "Ongailuak", p: 0.50, v: 'all' },
  { cat: "üç≥ Sukaldea / Cocina", n: "Tupper", p: 0.25, v: 'all' },
  { cat: "üç≥ Sukaldea / Cocina", n: "Gasa (15min)", p: 1.80, v: 'all' },
  { cat: "üç≥ Sukaldea / Cocina", n: "Bazkaria ¬∑ Comida", p: 3.00, v: 'all' },
  { cat: "üç≥ Sukaldea / Cocina", n: "Afaria ¬∑ Cena", p: 3.00, v: 'all' },
  { cat: "üç≥ Sukaldea / Cocina", n: "Merienda", p: 2.50, v: 'all' }
];

// --- NUEVO MEN√ö PARA LA SALLE (EKHI) ---
const MENU_LASALLE = [
  // Vinos
  { cat: "Vinos", n: "TINTO RESERVA REMELLURI", p: 26.90, v: 'all' },
  { cat: "Vinos", n: "TINTO RESERVA CERRO A√ëON", p: 12.00, v: 'all' },
  { cat: "Vinos", n: "TINTO CRIANZA PIEROLA", p: 12.40, v: 'all' },
  { cat: "Vinos", n: "TINTO CRIANZA VI√ëA REAL", p: 8.50, v: 'all' },
  { cat: "Vinos", n: "TINTO CRIANZA MAR VITORIA", p: 7.85, v: 'all' },
  { cat: "Vinos", n: "TINTO CRIANZA GLORIOSO", p: 7.70, v: 'all' },
  { cat: "Vinos", n: "TINTO CRIANZA CAMPILLO", p: 10.90, v: 'all' },
  { cat: "Vinos", n: "TINTO CRIANZA PROTOS", p: 19.80, v: 'all' },
  { cat: "Vinos", n: "TINTO DON HUGO", p: 3.40, v: 'all' },
  { cat: "Vinos", n: "SIDRA ZAPIAIN", p: 3.25, v: 'all' },
  { cat: "Vinos", n: "ROSADO ILAGARES", p: 4.50, v: 'all' },
  { cat: "Vinos", n: "LAMBRUSCO MONTEBERIN", p: 4.25, v: 'all' },
  { cat: "Vinos", n: "BLANCO VINA MAYOR VERDEJO", p: 6.65, v: 'all' },
  { cat: "Vinos", n: "TXAKOLI GAINTZA", p: 8.10, v: 'all' },
  { cat: "Vinos", n: "ALBARINO SEGREL", p: 9.90, v: 'all' },
  { cat: "Vinos", n: "CAVA OR", p: 13.00, v: 'all' },
  { cat: "Vinos", n: "CAVA ONDARRE MILLENNIUM", p: 8.60, v: 'all' },

  // Descorche
  { cat: "Descorche", n: "VINO X 750 CL", p: 2.50, v: 'all' },
  { cat: "Descorche", n: "LICORES X LITRO", p: 3.00, v: 'all' },
  { cat: "Descorche", n: "CAVA X 750 CL", p: 2.50, v: 'all' },
  { cat: "Descorche", n: "REFRESCOS GRANDES X 2 LITROS", p: 1.60, v: 'all' },
  { cat: "Descorche", n: "ACEITE X LITRO", p: 1.60, v: 'all' },
  { cat: "Descorche", n: "NO ASISTENCIA POR COMENSAL", p: 2.00, v: 'all' },

  // Cervezas
  { cat: "Cervezas", n: "CERVEZA SAN MIGUEL", p: 1.00, v: 'all' },
  { cat: "Cervezas", n: "CERVEZA SAN MIGUEL 0.0", p: 1.00, v: 'all' },
  { cat: "Cervezas", n: "CERVEZA HEINEKEN GRANDE", p: 1.50, v: 'all' },
  { cat: "Cervezas", n: "CERVEZA AMSTEL ORO", p: 1.70, v: 'all' },
  { cat: "Cervezas", n: "CERVEZA LEFFE", p: 2.95, v: 'all' },
  { cat: "Cervezas", n: "CERVEZA VOLL-DAMM", p: 2.70, v: 'all' },
  { cat: "Cervezas", n: "CERVEZA SAN MIGUEL SIN GLUTEN", p: 1.45, v: 'all' },
  { cat: "Cervezas", n: "CERVEZA 18/70", p: 2.00, v: 'all' },
  { cat: "Cervezas", n: "CERVEZA AMSTEL RADLER", p: 1.90, v: 'all' },

  // Refrescos
  { cat: "Refrescos", n: "COCA-COLA", p: 1.10, v: 'all' },
  { cat: "Refrescos", n: "COCA-COLA ZERO", p: 1.10, v: 'all' },
  { cat: "Refrescos", n: "KAS NARANJA", p: 1.10, v: 'all' },
  { cat: "Refrescos", n: "KAS LIMON", p: 1.10, v: 'all' },
  { cat: "Refrescos", n: "TONICA SCHWEPPES", p: 1.30, v: 'all' },
  { cat: "Refrescos", n: "GASEOSA LA CASERA 50 CI", p: 1.00, v: 'all' },
  { cat: "Refrescos", n: "AGUA MINERAL URALAI 1,5 L.", p: 1.00, v: 'all' },
  { cat: "Refrescos", n: "AGUA MINERAL BOTELLIN 0.33", p: 0.50, v: 'all' },
  { cat: "Refrescos", n: "AGUA CON GAS VICHY CATALAN", p: 1.80, v: 'all' },
  { cat: "Refrescos", n: "ZUMOS LAMBDA", p: 1.35, v: 'all' },
  { cat: "Refrescos", n: "BATIDOS", p: 1.25, v: 'all' },
  { cat: "Refrescos", n: "VERMOUTH MARTINI ROJO", p: 1.50, v: 'all' },
  { cat: "Refrescos", n: "BITTER CINZANO", p: 2.00, v: 'all' },
  { cat: "Refrescos", n: "BITTER KAS", p: 1.40, v: 'all' },

  // Caf√©s
  { cat: "Caf√©s", n: "CAFE O INFUSIONES", p: 1.00, v: 'all' },
  { cat: "Caf√©s", n: "NESQUICK Y COLACAO", p: 1.00, v: 'all' },

  // Licores
  { cat: "Licores", n: "BRANDY TORRES 10", p: 2.00, v: 'all' },
  { cat: "Licores", n: "GINEBRA GORDONS", p: 2.20, v: 'all' },
  { cat: "Licores", n: "GINEBRA BEEFEATER", p: 2.50, v: 'all' },
  { cat: "Licores", n: "GINEBRA BOMBAY", p: 2.70, v: 'all' },
  { cat: "Licores", n: "PATXARAN NAVARRA", p: 2.10, v: 'all' },
  { cat: "Licores", n: "ANIS CADENAS", p: 1.70, v: 'all' },
  { cat: "Licores", n: "LICOR DE CREMA RUAVIEJA", p: 1.85, v: 'all' },
  { cat: "Licores", n: "LICOR DE HIERBAS RUAVIEJA", p: 1.85, v: 'all' },
  { cat: "Licores", n: "LICOR DE ORUJO RUAVIEJA", p: 1.70, v: 'all' },
  { cat: "Licores", n: "RON BACARDI", p: 2.00, v: 'all' },
  { cat: "Licores", n: "RON BARCELO", p: 2.30, v: 'all' },
  { cat: "Licores", n: "RON HAVANA CLUB", p: 2.10, v: 'all' },
  { cat: "Licores", n: "WHISKY J. B.", p: 2.15, v: 'all' },
  { cat: "Licores", n: "WHISKY BALLANTINES", p: 2.00, v: 'all' },
  { cat: "Licores", n: "WHISKY CHIVAS", p: 3.80, v: 'all' },
  { cat: "Licores", n: "ARMAGNAC", p: 3.80, v: 'all' },
  { cat: "Licores", n: "COINTREAU", p: 2.85, v: 'all' },
  { cat: "Licores", n: "VODKA SMIRNOFF", p: 2.20, v: 'all' },
  { cat: "Licores", n: "PATXARAN ETXEKO", p: 2.10, v: 'all' },

  // Cocina
  { cat: "Cocina", n: "VAJILLA Y LIMPIEZA, MANTEL DE TELA Y SERVILLETA POR PERSONA", p: 3.20, v: 'all' },
  { cat: "Cocina", n: "VAJILLA Y LIMPIEZA, MANTEL DE PAPEL Y SERVILLETA POR PERSONA", p: 2.75, v: 'all' },
  { cat: "Cocina", n: "SERVILLETA TELA", p: 0.50, v: 'all' },
  { cat: "Cocina", n: "POR 30 MIN. DE FUEGO", p: 2.00, v: 'all' },
  { cat: "Cocina", n: "POR 30 MIN. DE HORNO", p: 2.00, v: 'all' },
  { cat: "Cocina", n: "POR 30 MIN. DE PLANCHA", p: 2.00, v: 'all' },
  { cat: "Cocina", n: "ACEITE UBEDA 250 ML", p: 2.50, v: 'all' },
  { cat: "Cocina", n: "ACEITE UBEDA 500 ML", p: 4.50, v: 'all' },
  { cat: "Cocina", n: "ACEITE DE GIRASOL 1 L.", p: 2.80, v: 'all' },
  { cat: "Cocina", n: "ENVASES/TUPPER 1,5 Y 2L", p: 0.80, v: 'all' },

  // Conservas
  { cat: "Conservas", n: "PIMIENTO PIQUILLO", p: 2.40, v: 'all' },
  { cat: "Conservas", n: "ACEITUNAS", p: 1.75, v: 'all' },
  { cat: "Conservas", n: "ESPARRAGOS", p: 6.85, v: 'all' },
  { cat: "Conservas", n: "ATUN CLARO PESCAMAR", p: 1.90, v: 'all' }
];

// Variable din√°mica que usar√° la app (vac√≠a al inicio)
let BASE_ITEMS = [];

// Variables globales
let ITEMS = [];
let CATEGORIES = {};
let DB_PATH = '';
let MENU_PATH = '';
let CURRENT_VENUE = '';
let isAdmin = false;
let isInitialLoad = true;
let state = { names: ["Persona 1", "Persona 2"], selections: [], common: [], payerIdx: 0, activeTab: 0 };
let UI_STATE = { general: new Set(), paxes: {} };

// --- FUNCI√ìN DE ARRANQUE MODIFICADA ---
window.startApp = function(venue) {
  // L√ìGICA DE SELECCI√ìN DE MEN√ö
  if (venue === 'ekhi') {
      BASE_ITEMS = MENU_LASALLE;
  } else {
      BASE_ITEMS = MENU_GENERAL;
  }

  CURRENT_VENUE = venue;
  DB_PATH = `gastosPro_v4_${venue}`;
  MENU_PATH = `menu_v4_${venue}`;
  isInitialLoad = true;
  document.getElementById('app-container').style.display = 'block';
  setTimeout(() => document.getElementById('landing-page').style.opacity = '0', 50);
  setTimeout(() => document.getElementById('landing-page').style.display = 'none', 300);
  init();
}

window.goBack = function() {
  if(DB_PATH) off(ref(db, DB_PATH));
  if(MENU_PATH) off(ref(db, MENU_PATH));
  isAdmin = false;
  document.getElementById('btnEditMode').classList.remove('active');
  document.getElementById('tab-btn-editor').classList.remove('visible');
  document.getElementById('landing-page').style.display = 'flex';
  setTimeout(() => document.getElementById('landing-page').style.opacity = '1', 50);
  document.getElementById('app-container').style.display = 'none';
}

window.toggleAdminMode = function() {
  if(isAdmin) {
    isAdmin = false;
    document.getElementById('btnEditMode').classList.remove('active');
    document.getElementById('tab-btn-editor').classList.remove('visible');
    if(state.activeTab === 99) switchTab(0);
  } else {
    const code = prompt("üîë C√≥digo de Administrador:");
    if(code === ADMIN_CODE) {
      isAdmin = true;
      document.getElementById('btnEditMode').classList.add('active');
      document.getElementById('tab-btn-editor').classList.add('visible');
      alert("Modo Edici√≥n Activado");
    } else if(code !== null) {
      alert("C√≥digo incorrecto");
    }
  }
}

// ‚ö†Ô∏è IMPORTANTE: Aqu√≠ contin√∫a el resto de tu c√≥digo original (funciones init, render, etc.)
// Aseg√∫rate de mantener todas las funciones que hab√≠a debajo de 'buildCategories' en tu archivo original.
// Como el archivo era muy largo, he tenido que cortar aqu√≠.
// Simplemente aseg√∫rate de que debajo de esto est√©n todas tus funciones antiguas:
// captureUiState, saveData, saveMenu, buildCategories, init, render, etc...

function captureUiState() {
  const genView = document.getElementById('view-general');
  if(genView) {
    UI_STATE.general = new Set();
    genView.querySelectorAll('details[open] summary').forEach(el => UI_STATE.general.add(el.innerText.trim()));
  }
  state.names.forEach((_, i) => {
    const pView = document.getElementById(`view-pax-${i}`);
    if(pView) {
      UI_STATE.paxes[i] = new Set();
      pView.querySelectorAll('details[open] summary').forEach(el => UI_STATE.paxes[i].add(el.innerText.trim()));
    }
  });
}

function saveData() {
  if(!DB_PATH) return;
  set(ref(db, DB_PATH), state).catch(err => console.error(err));
}

function saveMenu() {
  if(!MENU_PATH) return;
  set(ref(db, MENU_PATH), ITEMS).catch(err => console.error(err));
}

function buildCategories() {
  CATEGORIES = {};
  ITEMS.forEach((it, i) => {
    if(!CATEGORIES[it.cat]) CATEGORIES[it.cat] = [];
    CATEGORIES[it.cat].push({ ...it, idx: i });
  });
}

// ... (RESTO DE TU L√ìGICA ORIGINAL DEBE IR AQU√ç: init, render, updateVal, etc.) ...
// Si copias y pegas sobre tu archivo anterior, aseg√∫rate de NO BORRAR las funciones que van despu√©s de buildCategories.

</script>
</body>
</html>
